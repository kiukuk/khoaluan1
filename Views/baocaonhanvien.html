<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Báo cáo Nhân viên</title>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Averta+Std+CY:wght@400;600;700&display=swap" />
    <link rel="stylesheet" href="../Public/css/baocao.css" />
    <link rel="stylesheet" href="../Public/css/baocaonhanvien.css" />
    <!-- Thêm Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>

<body>
    <div class="main-container">
        <!-- Header -->
        <header class="header">
            <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/Spe1ONBMGo.png" alt="Logo"
                class="logo" />
            <div class="menu-right">
                <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/gFm7CJOc6m.png" alt="Support"
                    class="icon" />
                <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/OaQkGHAx1s.png" alt="Flag"
                    class="icon flag" />
                <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/xq6CkhC2ow.png"
                    alt="Notifications" class="icon" />
                <div class="user">
                    <span>Vũ Thị Kiều Cúc</span>
                    <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/xkBp40jWqg.png" alt="Avatar"
                        class="avatar" />
                </div>
            </div>
        </header>

        <!-- Menu -->
        <nav class="cms-menu">
            <a href="tongquan.html" class="menu-link">
                <div class="menu-item">
                    <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/RDy2m7oGdJ.png"
                        alt="Dashboard" class="menu-icon" />
                    <span>Tổng quan</span>
                </div>
            </a>
            <a href="taikhoan.html" class="menu-link">
                <div class="menu-item">
                    <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/Kb6jp7Zyvp.png"
                        alt="Account" class="menu-icon" />
                    <span>Tài khoản</span>
                </div>
            </a>
            <a href="hopdong.html" class="menu-link">
                <div class="menu-item">
                    <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/P3fdYxESjy.png"
                        alt="Contract" class="menu-icon" />
                    <span>Hợp đồng</span>
                </div>
            </a>
            <a href="khachhang.html" class="menu-link">
                <div class="menu-item">
                    <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/CSD90LxuhK.png"
                        alt="Customer" class="menu-icon" />
                    <span>Khách hàng</span>
                </div>
            </a>
            <div class="menu-link report-container" id="report-menu">
                <div class="menu-item selected">
                    <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/beO9yV4pmy.png" alt="Report"
                        class="menu-icon" />
                    <span>Báo cáo</span>
                </div>
                <!-- Table for Báo cáo -->
                <table class="report-table" id="report-table">
                    <tr class="table-row">
                        <td class="table-cell">
                            <a href="baocao.html" class="table-link">
                                <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/ZXvRTjMAJS.png"
                                    alt="Tổng hợp" class="table-icon" />
                                <span>Tổng hợp</span>
                            </a>
                        </td>
                    </tr>
                    <tr class="table-row">
                        <td class="table-cell">
                            <a href="baocaonhanvien.html" class="table-link">
                                <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/Kb6jp7Zyvp.png"
                                    alt="Nhân viên" class="table-icon" />
                                <span>Nhân viên</span>
                            </a>
                        </td>
                    </tr>
                    <tr class="table-row">
                        <td class="table-cell">
                            <a href="baocaohopdong.html" class="table-link">
                                <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/P3fdYxESjy.png"
                                    alt="Hợp đồng" class="table-icon" />
                                <span>Hợp đồng</span>
                            </a>
                        </td>
                    </tr>
                    <tr class="table-row">
                        <td class="table-cell">
                            <a href="baocaokhachhang.html" class="table-link">
                                <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/CSD90LxuhK.png"
                                    alt="Khách hàng" class="table-icon" />
                                <span>Khách hàng</span>
                            </a>
                        </td>
                    </tr>
                </table>
            </div>
            <a href="dulieu.html" class="menu-link">
                <div class="menu-item">
                    <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/kL7HC5Fh6x.png" alt="Data"
                        class="menu-icon" />
                    <span>Dữ liệu</span>
                </div>
            </a>

        </nav>

        <!-- Tiêu đề và nút "Xuất file" (nằm ngoài content-container) -->
        <div class="content-header">
            <h2 class="content-title">Báo cáo nhân viên</h2>
            <button class="export-btn">
                <span class="export-icon">⬇</span> Xuất file
            </button>
        </div>

        <!-- Nội dung chính -->
        <div class="content-container">
            <!-- Bộ lọc và bảng -->
            <div class="filter-and-table">
                <!-- Bộ lọc bên trái -->
                <div class="filter-column">
                    <!-- Dạng -->
                    <div class="filter-panel">
                        <h3 class="filter-title">Dạng</h3>
                        <div class="filter-content">
                            <div class="radio-group">
                                <label><input type="radio" name="report-type" value="bieu-do" /> Biểu đồ</label>
                                <label><input type="radio" name="report-type" value="bang" checked /> Bảng</label>
                            </div>
                        </div>
                    </div>
                    <!-- Thời gian -->
                    <div class="filter-panel">
                        <h3 class="filter-title">Thời gian</h3>
                        <div class="filter-content">
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="time-range" value="theo-ngay" checked />
                                    Theo ngày
                                </label>
                                <div class="date-group theo-ngay-dates" style="display: block;">
                                    <input type="date" id="single-date" />
                                </div>
                                <label>
                                    <input type="radio" name="time-range" value="theo-tuan" />
                                    Theo tuần
                                </label>
                                <div class="date-group theo-tuan-dates" style="display: none;">
                                    <label>Từ ngày</label>
                                    <input type="date" id="start-date-tuan" />
                                    <label>Đến ngày</label>
                                    <input type="date" id="end-date-tuan" />
                                </div>
                                <label>
                                    <input type="radio" name="time-range" value="theo-thang" />
                                    Theo tháng
                                </label>
                                <div class="date-group theo-thang-dates" style="display: none;">
                                    <label>Từ ngày</label>
                                    <input type="date" id="start-date-thang" />
                                    <label>Đến ngày</label>
                                    <input type="date" id="end-date-thang" />
                                </div>
                                <label>
                                    <input type="radio" name="time-range" value="theo-quy" />
                                    Theo quý
                                </label>
                                <div class="date-group theo-quy-dates" style="display: none;">
                                    <label>Từ ngày</label>
                                    <input type="date" id="start-date-quy" />
                                    <label>Đến ngày</label>
                                    <input type="date" id="end-date-quy" />
                                </div>
                                <label>
                                    <input type="radio" name="time-range" value="theo-nam" />
                                    Theo năm
                                </label>
                                <div class="date-group theo-nam-dates" style="display: none;">
                                    <label>Từ ngày</label>
                                    <input type="date" id="start-date-nam" />
                                    <label>Đến ngày</label>
                                    <input type="date" id="end-date-nam" />
                                </div>
                                <label>
                                    <input type="radio" name="time-range" value="khoang-thoi-gian" />
                                    Khoảng thời gian
                                </label>
                                <div class="date-group khoang-thoi-gian-dates" style="display: none;">
                                    <label>Từ ngày</label>
                                    <input type="date" id="start-date-khoang" />
                                    <label>Đến ngày</label>
                                    <input type="date" id="end-date-khoang" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bảng dữ liệu chính hoặc biểu đồ -->
                <div class="data-table-container">
                    <div class="table-title-row">
                        <span class="table-date">Ngày lập: 05/04/2025 09:47</span>
                        <h2 class="table-title">BÁO CÁO NHÂN VIÊN</h2>
                    </div>
                    <div class="table-meta">
                        <div class="meta-item">Ngày báo cáo: 01/01/2024 - 01/01/2024</div>
                    </div>
                    <!-- Bảng dữ liệu (hiển thị mặc định) -->
                    <table class="data-table" id="data-table">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Mã nhân viên</th>
                                <th>Tên nhân viên</th>
                                <th>Số dữ liệu khách hàng dự kiến</th>
                                <th>Số điện thoại</th>
                                <th>Tổng thành công</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Tổng</td>
                                <td></td>
                                <td></td>
                                <td>110</td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>NV02</td>
                                <td>Vũ Thị Kiều Cúc</td>
                                <td>1200</td>
                                <td>0987678789</td>
                                <td>100</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>NV02</td>
                                <td>Nguyễn Văn A</td>
                                <td>1000</td>
                                <td>0987678789</td>
                                <td>90</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>NV02</td>
                                <td>Vũ Thị Kiều Cúc</td>
                                <td>1000</td>
                                <td>0987678789</td>
                                <td>80</td>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td>NV02</td>
                                <td>Vũ Thị Kiều Cúc</td>
                                <td>900</td>
                                <td>0987678789</td>
                                <td>70</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td>NV02</td>
                                <td>Vũ Thị Kiều Cúc</td>
                                <td>900</td>
                                <td>0987678789</td>
                                <td>60</td>
                            </tr>
                            <tr>
                                <td>6</td>
                                <td>NV02</td>
                                <td>Vũ Thị Kiều Cúc</td>
                                <td>900</td>
                                <td>0987678789</td>
                                <td>58</td>
                            </tr>
                            <tr>
                                <td>7</td>
                                <td>NV02</td>
                                <td>Vũ Thị Kiều Cúc</td>
                                <td>900</td>
                                <td>0987678789</td>
                                <td>57</td>
                            </tr>
                            <tr>
                                <td>8</td>
                                <td>NV02</td>
                                <td>Vũ Thị Kiều Cúc</td>
                                <td>900</td>
                                <td>0987678789</td>
                                <td>56</td>
                            </tr>
                            <tr>
                                <td>9</td>
                                <td>NV02</td>
                                <td>Vũ Thị Kiều Cúc</td>
                                <td>900</td>
                                <td>0987678789</td>
                                <td>55</td>
                            </tr>
                            <tr>
                                <td>10</td>
                                <td>NV02</td>
                                <td>Vũ Thị Kiều Cúc</td>
                                <td>900</td>
                                <td>0987678789</td>
                                <td>54</td>
                            </tr>
                        </tbody>
                    </table>
                    <!-- Biểu đồ (ẩn mặc định) -->
                    <canvas id="employeeChart" style="display: none;"></canvas>
                </div>
            </div>
        </div>

        <!-- Footer (phân trang cố định) -->
        <footer class="footer">
            <div class="pagination">
                <span>Có 30 kết quả</span>
                <button>
                    << /button>
                        <button class="active">1</button>
                        <button>2</button>
                        <button>3</button>
                        <button>></button>
                        <span>10/ trang</span>
                        <label>Đi đến trang</label>
                        <input type="number" value="1" min="1" max="3" />
            </div>
        </footer>
    </div>

    <!-- JavaScript để xử lý hover, hiển thị input ngày, và vẽ biểu đồ -->
    <script>
        // Xử lý hover cho menu Báo cáo
        const reportContainer = document.getElementById('report-menu');
        const reportTable = document.getElementById('report-table');
        let hideTimeout;

        reportContainer.addEventListener('mouseenter', () => {
            clearTimeout(hideTimeout);
            reportTable.style.display = 'block';
        });

        reportContainer.addEventListener('mouseleave', (e) => {
            hideTimeout = setTimeout(() => {
                if (!reportTable.contains(e.relatedTarget)) {
                    reportTable.style.display = 'none';
                }
            }, 200);
        });

        reportTable.addEventListener('mouseenter', () => {
            clearTimeout(hideTimeout);
            reportTable.style.display = 'block';
        });

        reportTable.addEventListener('mouseleave', () => {
            hideTimeout = setTimeout(() => {
                reportTable.style.display = 'none';
            }, 200);
        });

        // Xử lý hiển thị input ngày dựa trên radio button được chọn
        const timeRangeRadios = document.querySelectorAll('input[name="time-range"]');
        const dateGroups = {
            'theo-ngay': document.querySelector('.theo-ngay-dates'),
            'theo-tuan': document.querySelector('.theo-tuan-dates'),
            'theo-thang': document.querySelector('.theo-thang-dates'),
            'theo-quy': document.querySelector('.theo-quy-dates'),
            'theo-nam': document.querySelector('.theo-nam-dates'),
            'khoang-thoi-gian': document.querySelector('.khoang-thoi-gian-dates')
        };

        timeRangeRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                // Ẩn tất cả các date-group
                Object.values(dateGroups).forEach(group => {
                    group.style.display = 'none';
                });

                // Hiển thị date-group tương ứng với radio được chọn
                const selectedValue = radio.value;
                if (dateGroups[selectedValue]) {
                    dateGroups[selectedValue].style.display = 'block';
                }
            });
        });

        // Xử lý hiển thị bảng hoặc biểu đồ dựa trên radio button "Dạng"
        const reportTypeRadios = document.querySelectorAll('input[name="report-type"]');
        const dataTable = document.getElementById('data-table');
        const chartCanvas = document.getElementById('employeeChart');
        let chartInstance = null;

        // Dữ liệu từ bảng
        const tableRows = dataTable.querySelectorAll('tbody tr');
        const labels = [];
        const data = [];

        // Lấy dữ liệu từ bảng (bỏ qua hàng "Tổng", chỉ lấy 10 hàng đầu tiên)
        Array.from(tableRows).slice(1, 11).forEach(row => {
            const cells = row.querySelectorAll('td');
            const employeeCode = cells[1].textContent;
            const employeeName = cells[2].textContent;
            const customerData = parseInt(cells[3].textContent);
            labels.push(`${employeeCode} - ${employeeName}`);
            data.push(customerData);
        });

        // Hàm vẽ biểu đồ
        function drawChart() {
            if (chartInstance) {
                chartInstance.destroy();
            }

            chartInstance = new Chart(chartCanvas, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Số dữ liệu khách hàng dự kiến',
                        data: data,
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y', // Thanh ngang
                    scales: {
                        x: {
                            beginAtZero: true,
                            min: 10,
                            max: 100,
                            ticks: {
                                stepSize: 10
                            },
                            title: {
                                display: true,
                                text: 'Số liệu khách hàng dự kiến'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Nhân viên'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Top 10 nhân viên có dữ liệu khách hàng thành công nhất',
                            font: {
                                size: 16
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `${context.dataset.label}: ${context.raw}`;
                                },
                                afterLabel: function (context) {
                                    return `Nguồn: ${context.label}`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Xử lý sự kiện thay đổi radio button "Dạng"
        reportTypeRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                if (radio.value === 'bieu-do') {
                    // Hiển thị biểu đồ, ẩn bảng
                    dataTable.style.display = 'none';
                    chartCanvas.style.display = 'block';
                    drawChart();
                } else {
                    // Hiển thị bảng, ẩn biểu đồ
                    dataTable.style.display = 'table';
                    chartCanvas.style.display = 'none';
                    if (chartInstance) {
                        chartInstance.destroy();
                        chartInstance = null;
                    }
                }
            });
        });
    </script>
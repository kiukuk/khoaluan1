<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Báo cáo Duyệt Khách hàng</title>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Averta+Std+CY:wght@400;600;700&display=swap" />
    <link rel="stylesheet" href="../Public/css/baocao.css" />
    <link rel="stylesheet" href="../Public/css/baocaokhachang.css" />
</head>

<body>
    <div class="main-container">
        <!-- Header -->
        <header class="header">
            <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/Spe1ONBMGo.png" alt="Logo"
                class="logo" />
            <div class="menu-right">
                <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/gFm7CJOc6m.png" alt="Support"
                    class="icon" />
                <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/OaQkGHAx1s.png" alt="Flag"
                    class="icon flag" />
                <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/xq6CkhC2ow.png"
                    alt="Notifications" class="icon" />
                <div class="user">
                    <span>Vũ Thị Kiều Cúc</span>
                    <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/xkBp40jWqg.png" alt="Avatar"
                        class="avatar" />
                </div>
            </div>
        </header>

        <!-- Menu -->
        <nav class="cms-menu">
            <a href="tongquan.html" class="menu-link">
                <div class="menu-item">
                    <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/RDy2m7oGdJ.png"
                        alt="Dashboard" class="menu-icon" />
                    <span>Tổng quan</span>
                </div>
            </a>
            <a href="taikhoan.html" class="menu-link">
                <div class="menu-item">
                    <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/Kb6jp7Zyvp.png"
                        alt="Account" class="menu-icon" />
                    <span>Tài khoản</span>
                </div>
            </a>
            <a href="hopdong.html" class="menu-link">
                <div class="menu-item">
                    <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/P3fdYxESjy.png"
                        alt="Contract" class="menu-icon" />
                    <span>Hợp đồng</span>
                </div>
            </a>
            <a href="khachhang.html" class="menu-link">
                <div class="menu-item">
                    <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/CSD90LxuhK.png"
                        alt="Customer" class="menu-icon" />
                    <span>Khách hàng</span>
                </div>
            </a>
            <div class="menu-link report-container" id="report-menu">
                <div class="menu-item selected">
                    <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/beO9yV4pmy.png" alt="Report"
                        class="menu-icon" />
                    <span>Báo cáo</span>
                </div>
                <!-- Table for Báo cáo -->
                <table class="report-table" id="report-table">
                    <tr class="table-row">
                        <td class="table-cell">
                            <a href="baocao.html" class="table-link">
                                <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/ZXvRTjMAJS.png"
                                    alt="Tổng hợp" class="table-icon" />
                                <span>Tổng hợp</span>
                            </a>
                        </td>
                    </tr>
                    <tr class="table-row">
                        <td class="table-cell">
                            <a href="baocaonhanvien.html" class="table-link">
                                <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/Kb6jp7Zyvp.png"
                                    alt="Nhân viên" class="table-icon" />
                                <span>Nhân viên</span>
                            </a>
                        </td>
                    </tr>
                    <tr class="table-row">
                        <td class="table-cell">
                            <a href="baocaohopdong.html" class="table-link">
                                <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/P3fdYxESjy.png"
                                    alt="Hợp đồng" class="table-icon" />
                                <span>Hợp đồng</span>
                            </a>
                        </td>
                    </tr>
                    <tr class="table-row">
                        <td class="table-cell">
                            <a href="baocaokhachhang.html" class="table-link">
                                <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/CSD90LxuhK.png"
                                    alt="Khách hàng" class="table-icon" />
                                <span>Khách hàng</span>
                            </a>
                        </td>
                    </tr>
                </table>
            </div>
            <a href="dulieu.html" class="menu-link">
                <div class="menu-item">
                    <img src="https://codia-f2c.s3.us-west-1.amazonaws.com/image/2025-04-11/kL7HC5Fh6x.png" alt="Data"
                        class="menu-icon" />
                    <span>Dữ liệu</span>
                </div>
            </a>
            
        </nav>

        <!-- Tiêu đề và nút "Xuất file" -->
        <div class="content-header">
            <h2 class="content-title">Báo cáo duyệt khách hàng</h2>
            <button class="export-btn">
                <span class="export-icon">⬇</span> Xuất file
            </button>
        </div>

        <!-- Nội dung chính -->
        <div class="content-container">
            <!-- Bộ lọc và bảng -->
            <div class="filter-and-table">
                <!-- Bộ lọc bên trái -->
                <div class="filter-column">
                    <!-- Hiển thị -->
                    <div class="filter-panel">
                        <h3 class="filter-title">Hiển thị</h3>
                        <div class="filter-content">
                            <div class="radio-group" id="display-options">
                                <label><input type="radio" name="display" value="data" checked /> Dữ liệu khách
                                    hàng</label>
                                <label><input type="radio" name="display" value="customer" /> Khách hàng</label>
                            </div>
                        </div>
                    </div>
                    <!-- Khoảng thời gian -->
                    <div class="filter-panel">
                        <h3 class="filter-title">Khoảng thời gian</h3>
                        <div class="filter-content">
                            <div class="date-group">
                                <label>Từ</label>
                                <input type="date" id="start-date" value="" />
                                <label>Đến</label>
                                <input type="date" id="end-date" value="" />
                            </div>
                        </div>
                    </div>
                    <!-- Nhân viên -->
                    <div class="filter-panel">
                        <h3 class="filter-title">Nhân viên</h3>
                        <div class="filter-content">
                            <select class="search-dropdown">
                                <option>Tìm kiếm nhân viên</option>
                            </select>
                            <div class="checkbox-group" id="employee-checkboxes">
                                <label><input type="checkbox" value="Đinh Thùy Linh" /> Đinh Thùy Linh</label>
                            </div>
                        </div>
                    </div>
                    <!-- Khu vực -->
                    <div class="filter-panel">
                        <h3 class="filter-title">Khu vực</h3>
                        <div class="filter-content">
                            <select class="search-dropdown">
                                <option>Tìm kiếm khu vực</option>
                            </select>
                            <div class="checkbox-group" id="area-checkboxes">
                                <label><input type="checkbox" value="Hà Nội" /> Hà Nội</label>
                                <label><input type="checkbox" value="TP. Hồ Chí Minh" /> TP. Hồ Chí Minh</label>
                                <label><input type="checkbox" value="Đà Nẵng" /> Đà Nẵng</label>
                            </div>
                        </div>
                    </div>
                    <!-- Trạng thái -->
                    <div class="filter-panel">
                        <h3 class="filter-title">Trạng thái</h3>
                        <div class="filter-content">
                            <select class="search-dropdown">
                                <option>Tìm kiếm trạng thái</option>
                            </select>
                            <div class="checkbox-group" id="status-checkboxes">
                                <label><input type="checkbox" value="Chưa bắt đầu" /> Chưa bắt đầu</label>
                                <label><input type="checkbox" value="Tạm ngưng" /> Tạm ngưng</label>
                                <label><input type="checkbox" value="Đang làm" /> Đang làm</label>
                                <label><input type="checkbox" value="Bàn giao" /> Bàn giao</label>
                                <label><input type="checkbox" value="Hoàn thành" /> Hoàn thành</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bảng bên phải -->
                <div class="data-table-container">
                    <!-- Bảng: Danh sách khách hàng -->
                    <div class="table-section">
                        <div class="table-title-row">
                            <span class="table-date">Ngày lập: 01/01/2025 09:47</span>
                            <div class="title-and-report-date">
                                <h2 class="table-title">BÁO CÁO DUYỆT KHÁCH HÀNG</h2>
                                <span class="report-date">Ngày báo cáo: 14/11/2025</span>
                            </div>
                        </div>
                        <table class="data-table" id="data-table">
                            <thead id="data-table-head">
                                <tr>
                                    <th>STT</th>
                                    <th>Mã khách hàng</th>
                                    <th>Tên khách hàng</th>
                                    <th>Khu vực</th>
                                    <th>Số điện thoại</th>
                                    <th>Lĩnh vực</th>
                                    <th>Thời gian</th>
                                    <th>Nhân viên phụ trách</th>
                                    <th>Trạng thái</th>
                                </tr>
                            </thead>
                            <tbody id="data-table-body">
                                <tr>
                                    <td>1</td>
                                    <td>DL0029023</td>
                                    <td>Vũ Thị Kiều Cúc</td>
                                    <td>TP. Hồ Chí Minh</td>
                                    <td>0838240956</td>
                                    <td>Giáo dục</td>
                                    <td>01/01/2025</td>
                                    <td>Đinh Thùy Linh</td>
                                    <td>Chưa bắt đầu</td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>DL0029023</td>
                                    <td>Vũ Thị Kiều Cúc</td>
                                    <td>TP. Hồ Chí Minh</td>
                                    <td>0838240956</td>
                                    <td>Kinh doanh</td>
                                    <td>02/02/2025</td>
                                    <td>Đinh Thùy Linh</td>
                                    <td>Tạm ngưng</td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <td>DL0029023</td>
                                    <td>Vũ Thị Kiều Cúc</td>
                                    <td>TP. Hồ Chí Minh</td>
                                    <td>0838240956</td>
                                    <td>Kinh doanh</td>
                                    <td>03/03/2025</td>
                                    <td>Đinh Thùy Linh</td>
                                    <td>Đang làm</td>
                                </tr>
                                <tr>
                                    <td>4</td>
                                    <td>DL0029023</td>
                                    <td>Vũ Thị Kiều Cúc</td>
                                    <td>Hà Nội</td>
                                    <td>0838240956</td>
                                    <td>Kinh doanh</td>
                                    <td>04/04/2025</td>
                                    <td>Đinh Thùy Linh</td>
                                    <td>Bàn giao</td>
                                </tr>
                                <tr>
                                    <td>5</td>
                                    <td>DL0029023</td>
                                    <td>Vũ Thị Kiều Cúc</td>
                                    <td>Hà Nội</td>
                                    <td>0838240956</td>
                                    <td>Doanh</td>
                                    <td>05/05/2025</td>
                                    <td>Đinh Thùy Linh</td>
                                    <td>Hoàn thành</td>
                                </tr>
                                <tr>
                                    <td>6</td>
                                    <td>DL0029023</td>
                                    <td>Vũ Thị Kiều Cúc</td>
                                    <td>Hà Nội</td>
                                    <td>0838240956</td>
                                    <td>Kinh doanh</td>
                                    <td>06/06/2025</td>
                                    <td>Đinh Thùy Linh</td>
                                    <td>Đang làm</td>
                                </tr>
                                <tr>
                                    <td>7</td>
                                    <td>DL0029023</td>
                                    <td>Vũ Thị Kiều Cúc</td>
                                    <td>Hà Nội</td>
                                    <td>0838240956</td>
                                    <td>Kinh doanh</td>
                                    <td>07/07/2025</td>
                                    <td>Đinh Thùy Linh</td>
                                    <td>Đang làm</td>
                                </tr>
                                <tr>
                                    <td>8</td>
                                    <td>DL0029023</td>
                                    <td>Vũ Thị Kiều Cúc</td>
                                    <td>Hà Nội</td>
                                    <td>0838240956</td>
                                    <td>Kinh doanh</td>
                                    <td>08/08/2025</td>
                                    <td>Đinh Thùy Linh</td>
                                    <td>Đang làm</td>
                                </tr>
                                <tr>
                                    <td>9</td>
                                    <td>DL0029023</td>
                                    <td>Vũ Thị Kiều Cúc</td>
                                    <td>Hà Nội</td>
                                    <td>0838240956</td>
                                    <td>Kinh doanh</td>
                                    <td>09/09/2025</td>
                                    <td>Đinh Thùy Linh</td>
                                    <td>Đang làm</td>
                                </tr>
                                <tr>
                                    <td>10</td>
                                    <td>DL0029023</td>
                                    <td>Vũ Thị Kiều Cúc</td>
                                    <td>Hà Nội</td>
                                    <td>0838240956</td>
                                    <td>Kinh doanh</td>
                                    <td>10/10/2025</td>
                                    <td>Đinh Thùy Linh</td>
                                    <td>Đang làm</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="pagination">
                <span>Có 30 kết quả</span>
                <button><</button>
                <button class="active">1</button>
                <button>2</button>
                <button>3</button>
                <button>></button>
                <span>10/ trang</span>
                <label>Đi đến trang</label>
                <input type="number" value="1" min="1" max="3" />
            </div>
        </footer>
    </div>

    <!-- JavaScript để xử lý hover và lọc dữ liệu -->
    <script>
        // Xử lý hover cho menu
        const reportContainer = document.getElementById('report-menu');
        const reportTable = document.getElementById('report-table');
        let hideTimeout;

        reportContainer.addEventListener('mouseenter', () => {
            clearTimeout(hideTimeout);
            reportTable.style.display = 'block';
        });

        reportContainer.addEventListener('mouseleave', (e) => {
            hideTimeout = setTimeout(() => {
                if (!reportTable.contains(e.relatedTarget)) {
                    reportTable.style.display = 'none';
                }
            }, 200);
        });

        reportTable.addEventListener('mouseenter', () => {
            clearTimeout(hideTimeout);
            reportTable.style.display = 'block';
        });

        reportTable.addEventListener('mouseleave', () => {
            hideTimeout = setTimeout(() => {
                reportTable.style.display = 'none';
            }, 200);
        });

        // Xử lý lọc dữ liệu
        const tableHead = document.getElementById('data-table-head');
        const tableBody = document.getElementById('data-table-body');

        // Dữ liệu gốc cho "Dữ liệu khách hàng"
        const dataCustomerRows = Array.from(tableBody.getElementsByTagName('tr')).map(row => row.cloneNode(true));

        // Dữ liệu gốc cho "Khách hàng"
        const customerRows = [
            { stt: 1, maKhachHang: "DL0029023", tenKhachHang: "Vũ Thị Kiều Cúc", linhVuc: "Kinh doanh", maHopDong: "NV0000012", thoiGian: "Hết hạn", thanhToan: "Đã thanh toán", trangThai: "Hoàn thành", nhanVien: "Đinh Thùy Linh" },
            { stt: 2, maKhachHang: "DL0029023", tenKhachHang: "Vũ Thị Kiều Cúc", linhVuc: "Kinh doanh", maHopDong: "NV0000012", thoiGian: "Hết hạn", thanhToan: "Đã thanh toán", trangThai: "Bàn giao", nhanVien: "Đinh Thùy Linh" },
            { stt: 3, maKhachHang: "DL0029023", tenKhachHang: "Vũ Thị Kiều Cúc", linhVuc: "Kinh doanh", maHopDong: "NV0000012", thoiGian: "05/06/2025", thanhToan: "Chưa gửi", trangThai: "Chưa bắt đầu", nhanVien: "Đinh Thùy Linh" },
            { stt: 4, maKhachHang: "DL0029023", tenKhachHang: "Vũ Thị Kiều Cúc", linhVuc: "Kinh doanh", maHopDong: "NV0000012", thoiGian: "05/06/2025", thanhToan: "Quá hạn", trangThai: "Đang làm", nhanVien: "Đinh Thùy Linh" },
            { stt: 5, maKhachHang: "DL0029023", tenKhachHang: "Vũ Thị Kiều Cúc", linhVuc: "Kinh doanh", maHopDong: "NV0000012", thoiGian: "05/06/2025", thanhToan: "Chưa gửi", trangThai: "Đang làm", nhanVien: "Đinh Thùy Linh" },
            { stt: 6, maKhachHang: "DL0029023", tenKhachHang: "Vũ Thị Kiều Cúc", linhVuc: "Kinh doanh", maHopDong: "NV0000012", thoiGian: "05/06/2025", thanhToan: "Chưa gửi", trangThai: "Đang làm", nhanVien: "Đinh Thùy Linh" },
            { stt: 7, maKhachHang: "DL0029023", tenKhachHang: "Vũ Thị Kiều Cúc", linhVuc: "Kinh doanh", maHopDong: "NV0000012", thoiGian: "05/06/2025", thanhToan: "Chưa gửi", trangThai: "Đang làm", nhanVien: "Đinh Thùy Linh" },
            { stt: 8, maKhachHang: "DL0029023", tenKhachHang: "Vũ Thị Kiều Cúc", linhVuc: "Kinh doanh", maHopDong: "NV0000012", thoiGian: "05/06/2025", thanhToan: "Chưa gửi", trangThai: "Đang làm", nhanVien: "Đinh Thùy Linh" },
            { stt: 9, maKhachHang: "DL0029023", tenKhachHang: "Vũ Thị Kiều Cúc", linhVuc: "Kinh doanh", maHopDong: "NV0000012", thoiGian: "05/06/2025", thanhToan: "Chưa gửi", trangThai: "Đang làm", nhanVien: "Đinh Thùy Linh" },
            { stt: 10, maKhachHang: "DL0029023", tenKhachHang: "Vũ Thị Kiều Cúc", linhVuc: "Kinh doanh", maHopDong: "NV0000012", thoiGian: "05/06/2025", thanhToan: "Đã thanh toán", trangThai: "Đang làm", nhanVien: "Đinh Thùy Linh" }
        ];

        function filterTable() {
            // Lấy giá trị từ các bộ lọc
            const startDateInput = document.getElementById('start-date').value;
            const endDateInput = document.getElementById('end-date').value;
            const startDate = startDateInput ? new Date(startDateInput) : null;
            const endDate = endDateInput ? new Date(endDateInput) : null;

            // Lấy giá trị hiển thị (Dữ liệu khách hàng hoặc Khách hàng)
            const displayOption = document.querySelector('input[name="display"]:checked').value;

            // Lấy danh sách nhân viên được chọn
            const employeeCheckboxes = document.querySelectorAll('#employee-checkboxes input:checked');
            const selectedEmployees = Array.from(employeeCheckboxes).map(cb => cb.value);

            // Lấy danh sách khu vực được chọn
            const areaCheckboxes = document.querySelectorAll('#area-checkboxes input:checked');
            const selectedAreas = Array.from(areaCheckboxes).map(cb => cb.value);

            // Lấy danh sách trạng thái được chọn
            const statusCheckboxes = document.querySelectorAll('#status-checkboxes input:checked');
            const selectedStatuses = Array.from(statusCheckboxes).map(cb => cb.value);

            // Xử lý hiển thị (Dữ liệu khách hàng hoặc Khách hàng)
            if (displayOption === "data") {
                // Cập nhật tiêu đề bảng cho "Dữ liệu khách hàng"
                tableHead.innerHTML = `
                    <tr>
                        <th>STT</th>
                        <th>Mã khách hàng</th>
                        <th>Tên khách hàng</th>
                        <th>Khu vực</th>
                        <th>Số điện thoại</th>
                        <th>Lĩnh vực</th>
                        <th>Thời gian</th>
                        <th>Nhân viên phụ trách</th>
                        <th>Trạng thái</th>
                    </tr>
                `;

                // Lọc dữ liệu khách hàng
                const filteredRows = dataCustomerRows.filter(row => {
                    const cells = row.getElementsByTagName('td');
                    const employee = cells[7].textContent; // Nhân viên phụ trách
                    const area = cells[3].textContent; // Khu vực
                    const status = cells[8].textContent; // Trạng thái
                    const timeStr = cells[6].textContent; // Thời gian (dd/mm/yyyy)
                    
                    // Kiểm tra khoảng thời gian
                    let dateInRange = true;
                    if (startDate || endDate) {
                        const [day, month, year] = timeStr.split('/').map(Number);
                        const rowDate = new Date(year, month - 1, day);
                        if (startDate && rowDate < startDate) dateInRange = false;
                        if (endDate && rowDate > endDate) dateInRange = false;
                    }

                    // Kiểm tra nhân viên
                    const employeeMatch = selectedEmployees.length === 0 || selectedEmployees.includes(employee);

                    // Kiểm tra khu vực
                    const areaMatch = selectedAreas.length === 0 || selectedAreas.includes(area);

                    // Kiểm tra trạng thái
                    const statusMatch = selectedStatuses.length === 0 || selectedStatuses.includes(status);

                    return dateInRange && employeeMatch && areaMatch && statusMatch;
                });

                // Cập nhật bảng
                tableBody.innerHTML = '';
                filteredRows.forEach((row, index) => {
                    row.cells[0].textContent = index + 1; // Cập nhật lại STT
                    tableBody.appendChild(row);
                });

            } else if (displayOption === "customer") {
                // Cập nhật tiêu đề bảng cho "Khách hàng"
                tableHead.innerHTML = `
                    <tr>
                        <th>STT</th>
                        <th>Mã khách hàng</th>
                        <th>Tên khách hàng</th>
                        <th>Lĩnh vực</th>
                        <th>Mã hợp đồng</th>
                        <th>Thời gian</th>
                        <th>Thanh toán</th>
                        <th>Trạng thái</th>
                        <th>Nhân viên phụ trách</th>
                    </tr>
                `;

                // Lọc dữ liệu khách hàng
                const filteredRows = customerRows.filter(row => {
                    const employee = row.nhanVien;
                    const status = row.trangThai;
                    const timeStr = row.thoiGian;

                    // Kiểm tra khoảng thời gian
                    let dateInRange = true;
                    if (startDate || endDate) {
                        if (timeStr !== "Hết hạn") {
                            const [day, month, year] = timeStr.split('/').map(Number);
                            const rowDate = new Date(year, month - 1, day);
                            if (startDate && rowDate < startDate) dateInRange = false;
                            if (endDate && rowDate > endDate) dateInRange = false;
                        }
                    }

                    // Kiểm tra nhân viên
                    const employeeMatch = selectedEmployees.length === 0 || selectedEmployees.includes(employee);

                    // Kiểm tra trạng thái
                    const statusMatch = selectedStatuses.length === 0 || selectedStatuses.includes(status);

                    // Khu vực không áp dụng cho bảng "Khách hàng"
                    return dateInRange && employeeMatch && statusMatch;
                });

                // Cập nhật bảng
                tableBody.innerHTML = '';
                filteredRows.forEach((row, index) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${row.maKhachHang}</td>
                        <td>${row.tenKhachHang}</td>
                        <td>${row.linhVuc}</td>
                        <td>${row.maHopDong}</td>
                        <td>${row.thoiGian}</td>
                        <td>${row.thanhToan}</td>
                        <td>${row.trangThai}</td>
                        <td>${row.nhanVien}</td>
                    `;
                    tableBody.appendChild(tr);
                });
            }
        }

        // Gắn sự kiện cho các bộ lọc
        document.getElementById('start-date').addEventListener('change', filterTable);
        document.getElementById('end-date').addEventListener('change', filterTable);
        document.querySelectorAll('#employee-checkboxes input').forEach(cb => cb.addEventListener('change', filterTable));
        document.querySelectorAll('#area-checkboxes input').forEach(cb => cb.addEventListener('change', filterTable));
        document.querySelectorAll('#status-checkboxes input').forEach(cb => cb.addEventListener('change', filterTable));
        document.querySelectorAll('input[name="display"]').forEach(radio => radio.addEventListener('change', filterTable));

        // Gọi lần đầu để áp dụng bộ lọc mặc định
        filterTable();
    </script>
</body>

</html>